---
description:
globs:
alwaysApply: false
---
# Arquitectura del Proyecto VML.Perito

## Estructura del Monorepo

Este es un monorepo con dos aplicaciones principales:

- **Backend (Express.js)**: [apps/server/](mdc:apps/server/) - API REST con RBAC y WebSockets
- **Frontend (React + Vite)**: [apps/web/](mdc:apps/web/) - Aplicación web con autenticación

## Backend - Estructura Principal

### Punto de Entrada
- [apps/server/index.js](mdc:apps/server/index.js) - Servidor Express principal con inicialización de WebSockets

### Configuración
- [apps/server/config/database.js](mdc:apps/server/config/database.js) - Configuración de Sequelize

### Modelos de Datos
- [apps/server/models/index.js](mdc:apps/server/models/index.js) - Definición de relaciones entre modelos
- [apps/server/models/user.js](mdc:apps/server/models/user.js) - Modelo de usuario
- [apps/server/models/role.js](mdc:apps/server/models/role.js) - Modelo de roles
- [apps/server/models/permission.js](mdc:apps/server/models/permission.js) - Modelo de permisos

### Controladores
- [apps/server/controllers/baseController.js](mdc:apps/server/controllers/baseController.js) - Controlador base con CRUD genérico
- [apps/server/controllers/userController.js](mdc:apps/server/controllers/userController.js) - Controlador de usuarios con notificaciones WebSocket
- [apps/server/controllers/authController.js](mdc:apps/server/controllers/authController.js) - Autenticación JWT

### Sistema RBAC
- [apps/server/middleware/rbac.js](mdc:apps/server/middleware/rbac.js) - Middleware de autorización basado en permisos
- [apps/server/middleware/permissionRegistry.js](mdc:apps/server/middleware/permissionRegistry.js) - Registro de permisos

### Sistema WebSockets
- [apps/server/websocket/index.js](mdc:apps/server/websocket/index.js) - Sistema principal de WebSockets
- [apps/server/websocket/socketManager.js](mdc:apps/server/websocket/socketManager.js) - Gestor de conexiones WebSocket
- [apps/server/websocket/notificationHandler.js](mdc:apps/server/websocket/notificationHandler.js) - Sistema de notificaciones
- [apps/server/websocket/realtimeHandler.js](mdc:apps/server/websocket/realtimeHandler.js) - Actualizaciones en tiempo real

## Frontend - Estructura Principal

### Punto de Entrada
- [apps/web/src/main.jsx](mdc:apps/web/src/main.jsx) - Punto de entrada de React
- [apps/web/src/App.jsx](mdc:apps/web/src/App.jsx) - Componente principal con rutas

### Configuración
- [apps/web/src/config/api.js](mdc:apps/web/src/config/api.js) - Configuración de endpoints de API

### Contextos
- [apps/web/src/contexts/auth-context.jsx](mdc:apps/web/src/contexts/auth-context.jsx) - Contexto de autenticación
- [apps/web/src/contexts/rbac-context.jsx](mdc:apps/web/src/contexts/rbac-context.jsx) - Contexto RBAC
- [apps/web/src/contexts/notification-context.jsx](mdc:apps/web/src/contexts/notification-context.jsx) - Contexto de notificaciones

### Componentes Principales
- [apps/web/src/components/PermissionGate.jsx](mdc:apps/web/src/components/PermissionGate.jsx) - Componente para control de acceso
- [apps/web/src/components/protected-route.jsx](mdc:apps/web/src/components/protected-route.jsx) - Rutas protegidas
- [apps/web/src/components/login-form.jsx](mdc:apps/web/src/components/login-form.jsx) - Formulario de login

### Layouts
- [apps/web/src/Layouts/AuthenticatedLayout.jsx](mdc:apps/web/src/Layouts/AuthenticatedLayout.jsx) - Layout para usuarios autenticados
- [apps/web/src/Layouts/GuestLayout.jsx](mdc:apps/web/src/Layouts/GuestLayout.jsx) - Layout para invitados

## Patrones de Arquitectura

### 1. Separación de Responsabilidades
- **Modelos**: Definición de datos y relaciones
- **Controladores**: Lógica de negocio y manejo de requests
- **Middleware**: Autenticación, autorización y validación
- **Servicios**: WebSockets y notificaciones

### 2. Sistema RBAC Integrado
- Permisos granulares por recurso y acción
- Middleware automático de verificación
- Contextos React para manejo de estado

### 3. Comunicación en Tiempo Real
- WebSockets con autenticación JWT
- Sistema de notificaciones tipificadas
- Canales de datos por permisos

### 4. Extensibilidad
- Controladores heredan de BaseController
- Sistema de eventos WebSocket extensible
- Componentes UI reutilizables
