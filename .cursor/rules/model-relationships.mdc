# Model Relationships and Database Structure

## Key Models and Their Relationships

### Inspection System

- **InspectionOrder**: Main entity for inspection requests
- **InspectionModality**: Types of inspection (SEDE, DOMICILIO, VIRTUAL)
- **Appointment**: Scheduled inspections linked to orders
- **ScheduleTemplate**: Time slots and availability rules

### Location System

- **Department** → **City** → **Sede**: Hierarchical location structure
- **Sede**: Physical locations where inspections occur
- **SedeModalityAvailability**: Links sedes with available modalities

### User and RBAC System

- **User**: System users with roles
- **Role**: User roles (admin, agent, etc.)
- **Permission**: Granular permissions
- **UserRole**: Many-to-many relationship

## Important Notes

- **InspectionType** has been removed - use **InspectionModality** instead
- All models use soft deletes via `baseModel.js`
- Relationships are defined in [models/index.js](mdc:apps/server/models/index.js)

## Controller Patterns

Controllers should follow the pattern from [scheduleController.js](mdc:apps/server/controllers/scheduleController.js):

- Constructor with method binding
- Proper error handling with Spanish messages
- Consistent response format

## Database Schema

Reference [curr_db_content.sql](mdc:apps/server/curr_db_content.sql) for current database structure and relationships.
description:
globs:
alwaysApply: false

---
