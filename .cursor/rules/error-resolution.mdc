---
description:
globs:
alwaysApply: false
---
# Manejo de Errores y Diagnóstico

## Error Actual: Columna `sede_id` Faltante

### Problema Identificado
- **Error**: `Unknown column 'sede_id' in 'field list'`
- **Causa**: La tabla `inspection_orders` no tiene la columna `sede_id`
- **Ubicación**: Modelo [apps/server/models/inspectionOrder.js](mdc:apps/server/models/inspectionOrder.js)

### Solución Requerida
1. **Ejecutar migración**: El script [apps/server/scripts/addSedeColumn.js](mdc:apps/server/scripts/addSedeColumn.js) está listo
2. **Comando necesario**: `node scripts/addSedeColumn.js` desde `apps/server`
3. **Verificación**: Confirmar que la columna se agregó correctamente

## Proceso de Diagnóstico

### Para Errores de Base de Datos
1. Verificar estructura de tablas
2. Revisar modelos Sequelize
3. Ejecutar migraciones si es necesario
4. Confirmar sincronización de modelos

### Para Errores de API
1. Verificar endpoints en [apps/server/index.js](mdc:apps/server/index.js)
2. Revisar controladores correspondientes
3. Validar middleware de autenticación
4. Confirmar rutas en [apps/web/src/config/api.js](mdc:apps/web/src/config/api.js)

### Para Errores de Frontend
1. Revisar componentes React
2. Validar contexto de autenticación
3. Verificar llamadas a API
4. Confirmar manejo de estados

## Comandos de Diagnóstico Útiles

```bash
# Verificar estructura de tabla
cd apps/server && node -e "const { sequelize } = require('./models'); sequelize.query('DESCRIBE inspection_orders').then(result => console.table(result[0]));"

# Probar endpoint simple
curl http://localhost:3000/api/test

# Verificar modelo
curl http://localhost:3000/api/inspection-orders-simple
```

## Archivos de Configuración Clave

- Base de datos: [apps/server/config/database.js](mdc:apps/server/config/database.js)
- Modelos: [apps/server/models/index.js](mdc:apps/server/models/index.js)
- Controlador: [apps/server/controllers/inspectionOrderController.js](mdc:apps/server/controllers/inspectionOrderController.js)
