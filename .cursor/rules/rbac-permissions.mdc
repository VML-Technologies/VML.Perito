# Sistema RBAC (Role-Based Access Control)

## Estructura de Permisos

- **Roles**: Definidos en [role.js](mdc:apps/server/models/role.js)
- **Permisos**: Definidos en [permission.js](mdc:apps/server/models/permission.js)
- **Asignaciones**: Relaciones N:N en [userRole.js](mdc:apps/server/models/userRole.js) y [rolePermission.js](mdc:apps/server/models/rolePermission.js)

## Roles Principales

- `super_admin`: Acceso completo al sistema
- `admin`: Administración con limitaciones
- `comercial_mundial`: Creación y gestión de órdenes
- `agente_contacto`: Gestión de llamadas y agendamientos
- `coordinador_contacto`: Supervisión y asignación de agentes
- `inspector`: Gestión de inspecciones
- `supervisor`: Asignación de inspectores

## Registro de Permisos

- Usar `registerPermission()` en controladores para registrar permisos
- Definir `resource`, `action`, `endpoint`, `method` para cada permiso
- Documentar descripción clara del permiso

## Middleware de Autorización

- Usar [rbac.js](mdc:apps/server/middleware/rbac.js) para verificación de permisos
- Implementar [permissionRegistry.js](mdc:apps/server/middleware/permissionRegistry.js) para registro dinámico
- Verificar permisos antes de ejecutar operaciones críticas

## Frontend - Control de Acceso

- Usar [rbac-context.jsx](mdc:apps/web/src/contexts/rbac-context.jsx) para estado de permisos
- Implementar `PermissionGate` para control granular de UI
- Usar `RoleBasedRoute` para protección de rutas
- Verificar permisos antes de mostrar acciones

## Patrones de Implementación

```javascript
// Backend - Verificar permiso
if (!req.user.hasPermission('inspection_orders.create')) {
  return res.status(403).json({
    success: false,
    message: 'No tienes permisos para crear órdenes',
  });
}

// Frontend - Control de UI
<PermissionGate permission="inspection_orders.create">
  <Button>Crear Orden</Button>
</PermissionGate>;
```

## Buenas Prácticas

- Siempre verificar permisos en backend, nunca confiar solo en frontend
- Usar nombres descriptivos para recursos y acciones
- Implementar logging de acciones sensibles
- Mantener consistencia en nomenclatura de permisos
  description:
  globs:
  alwaysApply: false

---
